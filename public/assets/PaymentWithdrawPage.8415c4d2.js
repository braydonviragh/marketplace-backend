import{_ as I,f as L,r as g,A as D,l as T,o as b,c as y,a,e as t,Q as d,g as z,w as s,aL as N,m as E,p as v,h as u,i as w,v as C,N as k,t as h,q as m,L as U,aJ as M,s as _,C as S}from"./index.1c4d6210.js";import{Q as $}from"./QInput.80880380.js";import{u as R,b as Y,a as A,Q as j}from"./QForm.7f12e950.js";import{Q as V}from"./QCardActions.d9fc1017.js";import{u as J}from"./use-quasar.119ee7f8.js";import"./use-id.0b69a5ed.js";import"./private.use-form.cfbbc316.js";const G={class:"q-pa-md"},H={class:"row justify-center"},K={class:"col-12 col-md-8 col-lg-6"},O={class:"q-mb-lg"},X={class:"text-h3 text-weight-bold text-primary q-mt-sm"},Z={key:1,class:"bg-grey-1 rounded-borders q-pa-lg q-mb-lg"},ee={class:"text-center"},ae={key:2,class:"bg-warning-1 rounded-borders q-pa-lg q-mb-lg"},te={class:"text-center"},le={key:3},se={class:"bg-grey-2 rounded-borders q-pa-md"},oe={class:"row items-center no-wrap"},re={class:"q-mt-lg"},ne={class:"q-mb-none"},ie={__name:"PaymentWithdrawPage",setup(de){J(),L();const n=R(),r=Y(),i=g(""),c=g(""),p=g(!1),f=g(!1),x=g(!1),q=D(()=>parseFloat(n.getBalance)>0&&r.hasStripeAccount&&r.isAccountVerified&&i.value&&i.value>0&&i.value<=parseFloat(n.getBalance)),W=async()=>{var o,e;try{await r.createStripeAccount();const l=await r.getAccountLink();window.open(l,"_blank")}catch(l){console.error("Error setting up Stripe account:",l),c.value=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to set up Stripe account"}},B=async()=>{var o,e;try{const l=await r.getAccountLink();window.open(l,"_blank")}catch(l){console.error("Error getting account link:",l),c.value=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to get account link"}},F=async()=>{var o,e;try{const l=await r.getDashboardLink();window.open(l,"_blank")}catch(l){console.error("Error opening Stripe dashboard:",l),c.value=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to open Stripe dashboard"}},Q=()=>{!q.value||(f.value=!0)},P=async()=>{var o,e;if(!!q.value)try{p.value=!0,c.value="",await n.initiateWithdraw(),await n.confirmWithdraw({amount:parseFloat(i.value),notes:"Withdrawal request from web interface"}),f.value=!1,x.value=!0,i.value="",await n.fetchBalance()}catch(l){console.error("Withdrawal error:",l),c.value=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to process withdrawal",f.value=!1}finally{p.value=!1}};return T(async()=>{try{await Promise.all([n.fetchBalance(),r.fetchStripeAccount()]),i.value=n.getBalance}catch(o){console.error("Failed to initialize:",o),c.value="Failed to load account data"}}),(o,e)=>(b(),y("div",G,[a("div",H,[a("div",K,[a("div",O,[t(d,{flat:"",icon:"arrow_back",color:"primary",onClick:e[0]||(e[0]=l=>o.$router.go(-1)),label:"Back",class:"q-mb-md"}),e[4]||(e[4]=a("h2",{class:"text-h4 q-mb-sm"},"Withdraw Funds",-1)),e[5]||(e[5]=a("p",{class:"text-grey-7"},"Transfer your earnings to your bank account",-1))]),c.value?(b(),z(N,{key:0,class:"bg-negative text-white q-mb-md",rounded:""},{avatar:s(()=>[t(w,{name:"error"})]),default:s(()=>[k(" "+h(c.value),1)]),_:1})):E("",!0),t(v,{flat:"",bordered:"",class:"q-mb-lg"},{default:s(()=>[t(m,null,{default:s(()=>[e[6]||(e[6]=a("div",{class:"text-subtitle1 text-grey-7"},"Available Balance",-1)),a("div",X,h(u(A)(u(n).getBalance)),1)]),_:1})]),_:1}),u(r).hasStripeAccount?u(r).isAccountVerified?(b(),y("div",le,[t(v,{bordered:"",class:"q-mb-lg"},{default:s(()=>[t(m,null,{default:s(()=>[e[15]||(e[15]=a("div",{class:"text-h6 q-mb-md"},"Withdrawal Details",-1)),t(j,{onSubmit:U(Q,["prevent"]),class:"q-gutter-md"},{default:s(()=>[a("div",null,[e[11]||(e[11]=a("label",{class:"text-subtitle2 q-mb-sm block"},"Amount to Withdraw",-1)),t($,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value=l),type:"number",outlined:"",rules:[l=>!!l||"Amount is required",l=>l>0||"Amount must be greater than 0",l=>l<=parseFloat(u(n).getBalance)||"Amount exceeds available balance"],prefix:"$",step:"0.01",min:"0.01",max:parseFloat(u(n).getBalance)},null,8,["modelValue","rules","max"])]),a("div",null,[e[12]||(e[12]=a("label",{class:"text-subtitle2 q-mb-sm block"},"Bank Account",-1)),e[13]||(e[13]=a("p",{class:"text-grey-7 q-mb-md"}," Funds will be transferred to your connected bank account through Stripe. ",-1)),t(d,{outline:"",color:"primary",icon:"account_balance",label:"Manage Bank Accounts","no-caps":"",class:"q-mb-md",onClick:F})]),a("div",se,[a("div",oe,[t(w,{name:"schedule",size:"2em",color:"grey-7",class:"q-mr-md"}),e[14]||(e[14]=a("div",null,[a("div",{class:"text-subtitle2"},"Processing Time"),a("div",{class:"text-grey-7"},"Withdrawals typically take 3-5 business days to process")],-1))])]),a("div",re,[t(d,{type:"submit",label:"Withdraw Funds",color:"primary",class:"full-width",loading:p.value,disable:!q.value||p.value},null,8,["loading","disable"])])]),_:1})]),_:1})]),_:1}),t(v,{bordered:"",class:"bg-grey-1"},{default:s(()=>[t(m,null,{default:s(()=>e[16]||(e[16]=[a("div",{class:"text-subtitle2 q-mb-sm"},"Important Information",-1),a("ul",{class:"q-mb-none text-grey-7"},[a("li",null,"Withdrawals are processed through Stripe's payment system"),a("li",null,"A small fee may apply for express withdrawals"),a("li",null,"For security reasons, new bank accounts may have a verification waiting period"),a("li",null,"If you have questions, please contact support")],-1)])),_:1})]),_:1})])):(b(),y("div",ae,[a("div",te,[t(w,{name:"warning",size:"3em",color:"orange"}),e[9]||(e[9]=a("div",{class:"text-h6 q-mt-md"},"Verification Required",-1)),e[10]||(e[10]=a("p",{class:"q-mb-md"},"Your Stripe account needs to be verified before you can withdraw funds.",-1)),t(d,{color:"warning",label:"Complete Verification","no-caps":"",loading:u(r).isLoading,onClick:B},null,8,["loading"])])])):(b(),y("div",Z,[a("div",ee,[t(w,{name:"account_balance",size:"3em",color:"grey-7"}),e[7]||(e[7]=a("div",{class:"text-h6 q-mt-md"},"Connect with Stripe",-1)),e[8]||(e[8]=a("p",{class:"q-mb-md"},"To withdraw funds, you need to connect your Stripe account first.",-1)),t(d,{color:"primary",label:"Set Up Stripe Account","no-caps":"",loading:u(r).isLoading,onClick:W},null,8,["loading"])])])),t(C,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),persistent:""},{default:s(()=>[t(v,{style:{"min-width":"350px"}},{default:s(()=>[t(m,{class:"row items-center"},{default:s(()=>[e[17]||(e[17]=a("div",{class:"text-h6"},"Confirm Withdrawal",-1)),t(M),_(t(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[S]])]),_:1}),t(m,null,{default:s(()=>[a("p",null,[e[18]||(e[18]=k("Are you sure you want to withdraw ")),a("strong",null,h(u(A)(i.value)),1),e[19]||(e[19]=k(" to your bank account?"))])]),_:1}),t(V,{align:"right"},{default:s(()=>[_(t(d,{flat:"",label:"Cancel",color:"grey-7","no-caps":""},null,512),[[S]]),t(d,{flat:"",label:"Confirm",color:"primary",onClick:P,loading:p.value,"no-caps":""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(C,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=l=>x.value=l)},{default:s(()=>[t(v,{class:"text-center",style:{"min-width":"350px"}},{default:s(()=>[t(m,null,{default:s(()=>[t(w,{name:"check_circle",color:"positive",size:"4em"}),e[20]||(e[20]=a("div",{class:"text-h6 q-mt-md"},"Withdrawal Initiated!",-1)),a("p",ne," Your withdrawal of "+h(u(A)(i.value))+" has been initiated successfully. The funds should appear in your bank account within 3-5 business days. ",1)]),_:1}),t(V,{align:"center"},{default:s(()=>[t(d,{flat:"",label:"View Transactions",color:"primary",to:"/profile","no-caps":""}),_(t(d,{flat:"",label:"Close",color:"grey-7","no-caps":""},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]))}};var ve=I(ie,[["__scopeId","data-v-ff9da322"]]);export{ve as default};
