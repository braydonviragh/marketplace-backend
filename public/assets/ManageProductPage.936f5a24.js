import{r as x,o as f,c as h,a as t,g as A,w as y,F as se,d as le,m as P,e as s,Q as u,t as w,f as ie,j as oe,l as re,X as de,ac as ne,n as ue,v as F,ab as ce,p as M,q as B,N as T,s as J,C as I}from"./index.1c4d6210.js";import{Q}from"./QInput.80880380.js";import{Q as L}from"./QCardActions.d9fc1017.js";import{u as G}from"./productAttributes.4e8c812d.js";import{_ as me}from"./SuccessDialog.a3ea3691.js";import{Q as ve,a as pe}from"./QCarousel.5ccbe75b.js";import{Q as R}from"./QSeparator.56f3d040.js";import{C as fe,_ as ge}from"./CreateProductStepTwo.a252f51b.js";import"./use-id.0b69a5ed.js";import"./private.use-form.cfbbc316.js";import"./QChip.b69f4eda.js";import"./format.8ac60962.js";import"./use-panel.fbc385e3.js";import"./touch.9135741d.js";import"./selection.f0756317.js";import"./use-render-cache.3aae9b27.js";import"./QSelect.aa5901c1.js";import"./QItemLabel.80798745.js";import"./QMenu.4990bf5e.js";const ye={class:"q-pa-md"},be={class:"bg-grey-1 rounded-lg p-4 q-mb-md"},_e={class:"q-mb-md relative"},xe=["src"],he={class:"q-mb-md relative"},we={class:"text-h6"},Ce={class:"text-h5 text-primary"},Pe={class:"relative"},$e={class:"q-mb-md text-body1"},De={class:"q-mb-md relative"},Se={class:"grid grid-cols-2 gap-2"},ke={class:"flex items-center"},qe={class:"text-body2 font-medium"},ze={class:"flex items-center"},Ne={class:"text-body2 font-medium"},Ue={class:"flex items-center"},Ve={class:"text-body2 font-medium"},Be={class:"flex items-center"},Qe={class:"text-body2 font-medium"},Ae={class:"flex items-center"},Ee={class:"text-body2 font-medium"},je={class:"flex justify-between q-mt-lg"},Oe={__name:"ManageProductDetail",props:{productData:{type:Object,required:!0},isSubmitting:{type:Boolean,default:!1}},emits:["edit","save","delete","back"],setup(m,{emit:U}){const b=m,$=G(),k=x(0),q=o=>{if(!o)return"Not selected";const e=$.categories.find(i=>i.id===o);return e?e.name:"Not selected"},_=o=>{if(!o)return"Not selected";const e=$.brands.find(i=>i.id===o);return e?e.name:"Not selected"},a=o=>{if(!o)return"Not selected";const e=$.styles.find(i=>i.id===o);return e?e.name:"Not selected"},v=o=>{if(!o)return"Not selected";const e=$.colors.find(i=>i.id===o);return e?e.name:"Not selected"},c=o=>{if(!o)return"Not selected";let e;return b.productData.size_type==="letter"?e=$.letterSizes.find(i=>i.id===o):b.productData.size_type==="number"?e=$.numberSizes.find(i=>i.id===o):b.productData.size_type==="waist"&&(e=$.waistSizes.find(i=>i.id===o)),e?e.display_name:"Not selected"};return(o,e)=>(f(),h("div",ye,[e[15]||(e[15]=t("h3",{class:"text-h5 q-mb-md"},"Manage Your Product",-1)),t("div",be,[t("div",_e,[m.productData.imagePreviewUrls&&m.productData.imagePreviewUrls.length?(f(),A(pe,{key:0,modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=i=>k.value=i),"transition-prev":"slide-right","transition-next":"slide-left",swipeable:"",animated:"","control-color":"primary",navigation:"",padding:"",arrows:"",height:"250px",class:"bg-white rounded-lg shadow-1"},{default:y(()=>[(f(!0),h(se,null,le(m.productData.imagePreviewUrls,(i,z)=>(f(),A(ve,{key:z,name:z,class:"column no-wrap flex-center"},{default:y(()=>[t("img",{src:i.url,class:"max-h-full object-contain"},null,8,xe)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])):P("",!0),s(u,{round:"",color:"primary",icon:"fas fa-pencil-alt",size:"sm",class:"absolute top-2 right-2 shadow-3",onClick:e[1]||(e[1]=i=>o.$emit("edit","media"))})]),t("div",he,[t("div",we,w(m.productData.title),1),t("div",Ce,"$"+w(m.productData.price)+" / day",1),s(u,{round:"",color:"primary",icon:"fas fa-pencil-alt",size:"sm",class:"absolute top-0 right-0",onClick:e[2]||(e[2]=i=>o.$emit("edit","basic"))})]),s(R,{class:"q-my-md"}),t("div",Pe,[e[8]||(e[8]=t("div",{class:"text-subtitle1 font-bold q-mb-sm"},"Description",-1)),t("p",$e,w(m.productData.description),1),s(u,{round:"",color:"primary",icon:"fas fa-pencil-alt",size:"sm",class:"absolute top-0 right-0",onClick:e[3]||(e[3]=i=>o.$emit("edit","description"))})]),s(R,{class:"q-my-md"}),t("div",De,[e[14]||(e[14]=t("div",{class:"text-subtitle1 font-bold q-mb-sm"},"Product Specifications",-1)),t("div",Se,[t("div",ke,[e[9]||(e[9]=t("div",{class:"text-grey-7 text-caption q-mr-xs"},"Category:",-1)),t("div",qe,w(q(m.productData.category_id)),1)]),t("div",ze,[e[10]||(e[10]=t("div",{class:"text-grey-7 text-caption q-mr-xs"},"Brand:",-1)),t("div",Ne,w(_(m.productData.brand_id)),1)]),t("div",Ue,[e[11]||(e[11]=t("div",{class:"text-grey-7 text-caption q-mr-xs"},"Style:",-1)),t("div",Ve,w(a(m.productData.style_id)),1)]),t("div",Be,[e[12]||(e[12]=t("div",{class:"text-grey-7 text-caption q-mr-xs"},"Color:",-1)),t("div",Qe,w(v(m.productData.color_id)),1)]),t("div",Ae,[e[13]||(e[13]=t("div",{class:"text-grey-7 text-caption q-mr-xs"},"Size:",-1)),t("div",Ee,w(c(m.productData.size_id)),1)])]),s(u,{round:"",color:"primary",icon:"fas fa-pencil-alt",size:"sm",class:"absolute top-0 right-0",onClick:e[4]||(e[4]=i=>o.$emit("edit","attributes"))})])]),t("div",je,[s(u,{outline:"",color:"grey-7",label:"Go Back",onClick:e[5]||(e[5]=i=>o.$emit("back")),"no-caps":"",icon:"fas fa-arrow-left"}),t("div",null,[s(u,{outline:"",color:"negative",label:"Delete Product",class:"q-mr-sm",onClick:e[6]||(e[6]=i=>o.$emit("delete")),"no-caps":"",icon:"fas fa-trash"}),s(u,{color:"primary",label:"Save Changes",onClick:e[7]||(e[7]=i=>o.$emit("save")),loading:m.isSubmitting,"no-caps":"",icon:"fas fa-save"},null,8,["loading"])])])]))}},Fe={class:"max-w-3xl mx-auto p-4 mb-12 relative"},Me={key:0,class:"absolute inset-0 bg-white bg-opacity-75 z-50 flex items-center justify-center",style:{cursor:"not-allowed"}},Te={key:1},Je={class:"q-mb-md"},Ie={class:"q-gutter-y-md"},Le={key:0,class:"text-negative text-sm mt-1"},Re={key:1,class:"text-negative text-sm mt-1"},Ge={class:"flex justify-end q-mt-md"},Xe={key:2},Ye={class:"q-mb-md"},He={class:"q-gutter-y-md"},Ke={key:0,class:"text-negative text-sm mt-1"},We={class:"flex justify-end q-mt-md"},Ze={key:3},et={class:"q-mb-md"},tt={class:"q-gutter-y-md"},at={class:"flex justify-end q-mt-md"},st={key:4},lt={class:"q-mb-md"},it={class:"q-gutter-y-md"},ot={class:"flex justify-end q-mt-md"},Dt={__name:"ManageProductPage",setup(m){const U=ie(),b=ce(),$=G(),k=oe(),q=x(!1),_=x(!1),a=x(null),v=x(null),c=x({}),o=x(!1),e=x(!1),i=x(!1),z=x(""),C=x(null),E=async()=>{var r,l,d,p,D,g;if(!b.params.id){U.push({name:"home"});return}q.value=!0;try{const n=await k.fetchProductById(b.params.id);a.value={id:n.id,title:n.title||"",description:n.description||"",category_id:((r=n.category)==null?void 0:r.id)||null,brand_id:((l=n.brand)==null?void 0:l.id)||null,style_id:((d=n.style)==null?void 0:d.id)||null,color_id:((p=n.color)==null?void 0:p.id)||null,price:parseFloat(n.price)||null,size_type:((D=n.size)==null?void 0:D.type)||null,size_id:((g=n.size)==null?void 0:g.id)||null,media:null,imagePreviewUrls:[],images:[]},n.media&&n.media.length>0&&(a.value.imagePreviewUrls=n.media.map(S=>({url:S.url,id:S.id,file:null,progress:100,order:S.order}))),v.value=JSON.parse(JSON.stringify(a.value))}catch(n){console.error("Failed to fetch product:",n)}finally{q.value=!1}},X=async()=>{try{await $.fetchAllAttributes()}catch(r){console.error("Failed to load product attributes:",r)}},Y=r=>{C.value=r},V=()=>{if(C.value){const r=C.value;r==="basic"?(a.value.title=v.value.title,a.value.price=v.value.price):r==="description"?a.value.description=v.value.description:r==="media"?(a.value.media=v.value.media,a.value.imagePreviewUrls=JSON.parse(JSON.stringify(v.value.imagePreviewUrls))):r==="attributes"&&(a.value.category_id=v.value.category_id,a.value.brand_id=v.value.brand_id,a.value.style_id=v.value.style_id,a.value.color_id=v.value.color_id,a.value.size_type=v.value.size_type,a.value.size_id=v.value.size_id)}C.value=null,c.value={}},H=r=>{a.value={...a.value,media:r.media,imagePreviewUrls:r.imagePreviewUrls}},K=r=>{a.value={...a.value,category_id:r.category_id,brand_id:r.brand_id,style_id:r.style_id,color_id:r.color_id,size_type:r.size_type,size_id:r.size_id}},j=r=>{c.value={...c.value,...r}},N=()=>{o.value=!0},W=async()=>{o.value=!1,await Z()},Z=async()=>{var r,l,d;if(!(!a.value||!b.params.id)){_.value=!0,c.value={};try{const p=new FormData;if(p.append("_method","PUT"),p.append("id",b.params.id),Object.keys(a.value).forEach(g=>{g!=="images"&&g!=="media"&&g!=="imagePreviewUrls"&&a.value[g]!==null&&p.append(g,a.value[g])}),a.value.imagePreviewUrls&&a.value.imagePreviewUrls.length>0){const g=a.value.imagePreviewUrls.map((n,S)=>{const O={id:n.id||null,order:S+1};return n.file instanceof File&&(O.file=n.file),O});p.append("media",JSON.stringify(g)),g.forEach((n,S)=>{n.file&&p.append(`media[${S}][file]`,n.file)})}else p.append("media",JSON.stringify([]));const D=await k.updateProduct(b.params.id,p);D&&(D.status===200||D.status==="success"||((r=D.data)==null?void 0:r.status)==="success")&&(z.value="Product updated successfully!",i.value=!0,await E(),C.value=null,setTimeout(()=>{i.value=!1},1500))}catch(p){console.error("Failed to update product:",p),(d=(l=p.response)==null?void 0:l.data)!=null&&d.errors&&(c.value=p.response.data.errors)}finally{_.value=!1}}},ee=()=>{e.value=!0},te=async()=>{e.value=!1,_.value=!0;try{await k.deleteProduct(b.params.id),z.value="Product deleted successfully!",i.value=!0,setTimeout(()=>{i.value=!1,U.push({name:"profile"})},1500)}catch(r){console.error("Failed to delete product:",r)}finally{_.value=!1}},ae=()=>{U.push({name:"product-details",params:{id:b.params.id}})};return re(async()=>{await X(),await E()}),de(()=>a.value,()=>{c.value={}},{deep:!0}),(r,l)=>(f(),h("div",Fe,[q.value?(f(),h("div",Me,[s(ne,{color:"primary",size:"3em"})])):P("",!0),t("div",{class:"bg-white rounded-lg shadow p-6 pt-3",style:ue({opacity:q.value?"0.5":"1"})},[l[10]||(l[10]=t("h1",{class:"text-2xl font-semibold mb-6 mt-0"},"Manage Product",-1)),!C.value&&a.value?(f(),A(Oe,{key:0,"product-data":a.value,"is-submitting":_.value,onEdit:Y,onSave:N,onDelete:ee,onBack:ae},null,8,["product-data","is-submitting"])):P("",!0),C.value==="basic"?(f(),h("div",Te,[t("div",Je,[s(u,{outline:"",color:"grey",icon:"fas fa-arrow-left",label:"Back",onClick:V,"no-caps":""}),l[6]||(l[6]=t("h2",{class:"text-xl font-medium"},"Edit Basic Information",-1))]),t("div",Ie,[s(Q,{modelValue:a.value.title,"onUpdate:modelValue":l[0]||(l[0]=d=>a.value.title=d),label:"Title *",rules:[d=>!!d||"Title is required",d=>d.length>=3||"Title must be at least 3 characters"],"lazy-rules":""},null,8,["modelValue","rules"]),c.value.title?(f(),h("div",Le,w(c.value.title[0]),1)):P("",!0),s(Q,{modelValue:a.value.price,"onUpdate:modelValue":l[1]||(l[1]=d=>a.value.price=d),label:"Price per Day (CAD) *",type:"number",prefix:"$",rules:[d=>!!d||"Price is required",d=>d>0||"Price must be greater than 0"],"lazy-rules":""},null,8,["modelValue","rules"]),c.value.price?(f(),h("div",Re,w(c.value.price[0]),1)):P("",!0),t("div",Ge,[s(u,{color:"primary",label:"Save Changes",onClick:N,loading:_.value,"no-caps":""},null,8,["loading"])])])])):P("",!0),C.value==="description"?(f(),h("div",Xe,[t("div",Ye,[s(u,{outline:"",color:"grey",icon:"fas fa-arrow-left",label:"Back",onClick:V,"no-caps":""}),l[7]||(l[7]=t("h2",{class:"text-xl font-medium"},"Edit Description",-1))]),t("div",He,[s(Q,{modelValue:a.value.description,"onUpdate:modelValue":l[2]||(l[2]=d=>a.value.description=d),type:"textarea",label:"Description *",rules:[d=>!!d||"Description is required",d=>d.length>=10||"Description must be at least 10 characters"],"lazy-rules":""},null,8,["modelValue","rules"]),c.value.description?(f(),h("div",Ke,w(c.value.description[0]),1)):P("",!0),t("div",We,[s(u,{color:"primary",label:"Save Changes",onClick:N,loading:_.value,"no-caps":""},null,8,["loading"])])])])):P("",!0),C.value==="media"?(f(),h("div",Ze,[t("div",et,[s(u,{outline:"",color:"grey",icon:"fas fa-arrow-left",label:"Back",onClick:V,"no-caps":""}),l[8]||(l[8]=t("h2",{class:"text-xl font-medium"},"Edit Product Images",-1))]),t("div",tt,[s(fe,{"initial-data":a.value,"api-errors":c.value,"onUpdate:data":H,"onUpdate:errors":j},null,8,["initial-data","api-errors"]),t("div",at,[s(u,{color:"primary",label:"Save Changes",onClick:N,loading:_.value,"no-caps":""},null,8,["loading"])])])])):P("",!0),C.value==="attributes"?(f(),h("div",st,[t("div",lt,[s(u,{outline:"",color:"grey",icon:"fas fa-arrow-left",label:"Back",onClick:V,"no-caps":""}),l[9]||(l[9]=t("h2",{class:"text-xl font-medium"},"Edit Product Specifications",-1))]),t("div",it,[s(ge,{"initial-data":a.value,"api-errors":c.value,"onUpdate:data":K,"onUpdate:errors":j},null,8,["initial-data","api-errors"]),t("div",ot,[s(u,{color:"primary",label:"Save Changes",onClick:N,loading:_.value,"no-caps":""},null,8,["loading"])])])])):P("",!0)],4),s(F,{modelValue:o.value,"onUpdate:modelValue":l[3]||(l[3]=d=>o.value=d),persistent:""},{default:y(()=>[s(M,null,{default:y(()=>[s(B,{class:"row items-center"},{default:y(()=>l[11]||(l[11]=[t("div",{class:"text-h6"},"Confirm Save",-1)])),_:1}),s(B,null,{default:y(()=>l[12]||(l[12]=[T(" Are you sure you want to save these changes? ")])),_:1}),s(L,{align:"right"},{default:y(()=>[J(s(u,{flat:"",label:"Cancel",color:"primary"},null,512),[[I]]),s(u,{flat:"",label:"Confirm",color:"primary",onClick:W})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(F,{modelValue:e.value,"onUpdate:modelValue":l[4]||(l[4]=d=>e.value=d),persistent:""},{default:y(()=>[s(M,null,{default:y(()=>[s(B,{class:"row items-center"},{default:y(()=>l[13]||(l[13]=[t("div",{class:"text-h6 text-negative"},"Delete Product",-1)])),_:1}),s(B,null,{default:y(()=>l[14]||(l[14]=[T(" Are you sure you want to delete this product? This action cannot be undone. ")])),_:1}),s(L,{align:"right"},{default:y(()=>[J(s(u,{flat:"",label:"Cancel",color:"primary"},null,512),[[I]]),s(u,{flat:"",label:"Delete",color:"negative",onClick:te})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(me,{modelValue:i.value,"onUpdate:modelValue":l[5]||(l[5]=d=>i.value=d),message:z.value},null,8,["modelValue","message"])]))}};export{Dt as default};
