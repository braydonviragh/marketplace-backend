import{I as l,u as d,J as f}from"./index.1c4d6210.js";const g=l("offers",{state:()=>({offers:[],currentOffer:null,activeTab:"sent",tabOptions:[{label:"Sent Offers",value:"sent",icon:"send"},{label:"Received Offers",value:"received",icon:"inbox"}],filters:{offer_status_id:null,search:null,start_date:null,end_date:null},pagination:{currentPage:1,totalPages:1,perPage:20},isLoading:!1,error:null,sentOffers:[],receivedOffers:[],statuses:[]}),getters:{getOffers:e=>e.offers,getCurrentOffer:e=>e.currentOffer,getFilters:e=>e.filters,getPagination:e=>e.pagination,getSentOffers:e=>e.sentOffers,getReceivedOffers:e=>e.receivedOffers,getActiveTab:e=>e.activeTab,getFilteredOffers:e=>e.offers.filter(r=>{var a,i,n;let s=!0;const t=e.filters;if(t.offer_status_id&&r.status.id!==t.offer_status_id&&(s=!1),t.search){const o=t.search.toLowerCase();s=[(a=r.product)==null?void 0:a.title,(i=r.user)==null?void 0:i.name,(n=r.status)==null?void 0:n.name].filter(Boolean).some(c=>c.toLowerCase().includes(o))}return t.start_date&&new Date(r.created_at)<new Date(t.start_date)&&(s=!1),t.end_date&&new Date(r.created_at)>new Date(t.end_date)&&(s=!1),s}),getStatusOptions:e=>e.statuses},actions:{async fetchOffers(e={}){var r,s;try{if(!d().currentUser)return console.log("Skipping offers fetch: User not authenticated"),[];this.isLoading=!0;const a=await f.get(`/offers/${this.activeTab}`,{params:{...this.filters,page:this.pagination.currentPage,per_page:this.pagination.perPage,...e}});return this.pagination={currentPage:a.data.meta.current_page,totalPages:a.data.meta.last_page,perPage:a.data.meta.per_page},this.offers=a.data.data,a.data.data}catch(t){throw this.error=((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to fetch offers",t}finally{this.isLoading=!1}},async fetchSentOffers(){var e,r;try{if(!d().currentUser)return console.log("Skipping sent offers fetch: User not authenticated"),[];this.isLoading=!0;const t=await f.get("/offers/sent");return this.sentOffers=t.data.data,t.data.data}catch(s){throw this.error=((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to fetch sent offers",s}finally{this.isLoading=!1}},async fetchReceivedOffers(){var e,r;try{if(!d().currentUser)return console.log("Skipping received offers fetch: User not authenticated"),[];this.isLoading=!0;const t=await f.get("/offers/received");return this.receivedOffers=t.data.data,t.data.data}catch(s){throw this.error=((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to fetch received offers",s}finally{this.isLoading=!1}},async fetchOfferById(e){var r,s;try{if(!d().currentUser)return console.log("Skipping offer fetch by ID: User not authenticated"),null;this.isLoading=!0;const a=await f.get(`/offers/${e}`);return this.currentOffer=a.data.data,a.data.data}catch(t){throw this.error=((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to fetch offer",t}finally{this.isLoading=!1}},async createOffer(e){var r,s;try{this.isLoading=!0;const t=await f.post("/offers",e);return this.offers.unshift(t.data.data),t.data}catch(t){throw this.error=((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to create offer",t}finally{this.isLoading=!1}},async updateOffer(e,r){var s,t,a;try{this.isLoading=!0;const i=await f.put(`/offers/${e}`,r),n=this.offers.findIndex(o=>o.id===e);return n!==-1&&(this.offers[n]=i.data.data),((s=this.currentOffer)==null?void 0:s.id)===e&&(this.currentOffer=i.data.data),i.data.data}catch(i){throw this.error=((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update offer",i}finally{this.isLoading=!1}},async updateOfferStatus(e,r){var s,t,a;try{this.isLoading=!0;const i=await f.post(`/offers/${e}/status`,{status:r}),n=this.offers.findIndex(o=>o.id===e);return n!==-1&&(this.offers[n]=i.data.data),((s=this.currentOffer)==null?void 0:s.id)===e&&(this.currentOffer=i.data.data),i.data}catch(i){throw this.error=((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update offer status",i}finally{this.isLoading=!1}},async deleteOffer(e){var r,s,t;try{this.isLoading=!0,await f.delete(`/offers/${e}`),this.offers=this.offers.filter(a=>a.id!==e),((r=this.currentOffer)==null?void 0:r.id)===e&&(this.currentOffer=null)}catch(a){throw this.error=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete offer",a}finally{this.isLoading=!1}},setFilters(e){this.filters={...this.filters,...e},this.pagination.currentPage=1},setActiveTab(e){this.activeTab=e},clearFilters(){this.filters={offer_status_id:null,search:null,start_date:null,end_date:null}},resetPagination(){this.pagination={currentPage:1,totalPages:1,perPage:20}},async fetchStatuses(){try{const e=await f.get("/offer-statuses");this.statuses=e.data.data.map(r=>({label:r.name,value:r.id,description:r.description}))}catch(e){throw console.error("Error fetching offer statuses:",e),e}}}});export{g as u};
