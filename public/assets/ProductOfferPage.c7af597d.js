import{_ as te,g as se,k as le,u as oe,r as f,c as u,m as re,o as c,a as Y,f as l,w as n,F as j,ac as ne,O as ue,Q as k,d as a,h as b,t as i,j as V,p as P,N as ie}from"./index.aed2db9c.js";import{Q as de}from"./QSkeleton.04818e3c.js";import{Q as me}from"./QAvatar.d0b7ca79.js";import{Q as I,a as N}from"./QPopupProxy.eb90e6eb.js";import{Q as E}from"./QInput.52b28155.js";import{Q as ce}from"./QSpinnerDots.464d7f1c.js";import{d}from"./date.d974a712.js";import{u as pe}from"./use-quasar.274aa12c.js";import{u as fe}from"./offers.57f07724.js";import{D as ve,_ as ye}from"./DetailPageHeader.a4ef8dcf.js";import{_ as _e}from"./SuccessDialog.35c8bdda.js";import{I as De}from"./ImageCarousel.56064351.js";import"./use-render-cache.3aae9b27.js";import"./private.use-form.e6da8665.js";import"./format.8ac60962.js";import"./QMenu.2e7dc152.js";import"./selection.ba1a87f1.js";import"./use-id.1f67328e.js";import"./QCardActions.499540f5.js";import"./QImg.526056a5.js";import"./QCarousel.598c4420.js";import"./use-panel.16148079.js";import"./touch.9135741d.js";const ge={class:"space-y-6"},xe={class:"bg-white rounded-lg shadow-sm overflow-hidden"},Ye={key:1,src:"https://placehold.co/600x400",class:"w-full h-full object-cover"},be={class:"p-4"},we={class:"text-lg font-semibold"},he={class:"text-primary font-medium"},Me={class:"bg-white rounded-lg p-4 shadow-sm"},ke={key:0,class:"flex items-center gap-3"},Ve=["src"],Pe={class:"flex items-center gap-2"},Qe={class:"text-lg font-medium m-0 text-primary"},Se={class:"text-gray-500 text-sm m-0"},$e={class:"bg-white rounded-lg p-4 shadow-sm space-y-4"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ce={class:"relative"},Fe={class:"space-y-2"},Oe={class:"flex justify-between"},Re={class:"flex justify-between"},Te={class:"flex justify-between"},Ue={class:"flex justify-between"},je={class:"text-gray-600"},Ie={class:"flex justify-between font-semibold"},Ne={class:"flex gap-4"},Ee={__name:"ProductOfferPage",setup(ze){const z=ne(),A=se();pe();const G=le(),L=oe(),W=fe(),w=f(!1),s=f(null),v=f(!0),h=f(null),o=f(null),m=f(null),x=f(!1),Q=u(()=>d.formatDate(Date.now(),"YYYY-MM-DD")),q=u(()=>{var t;return(t=s.value)!=null&&t.max_rental_days?d.formatDate(d.addToDate(Date.now(),{days:90}),"YYYY-MM-DD"):null}),H=u(()=>o.value||Q.value),J=u(()=>{var t;return!o.value||!((t=s.value)!=null&&t.max_rental_days)?null:d.formatDate(d.addToDate(d.extractDate(o.value,"YYYY-MM-DD"),{days:s.value.max_rental_days}),"YYYY-MM-DD")}),_=u(()=>!o.value||!m.value?0:d.getDateDiff(d.extractDate(m.value,"YYYY-MM-DD"),d.extractDate(o.value,"YYYY-MM-DD"),"days")),M=u(()=>{var t;return!((t=s.value)!=null&&t.price)||!_.value?0:s.value.price*_.value}),S=u(()=>{var D,g,p;const t=(p=(g=(D=L.currentUser)==null?void 0:D.profile)==null?void 0:g.province)==null?void 0:p.code;return{ON:13,BC:12,AB:5}[t]||13}),$=u(()=>parseFloat(M.value)*S.value/100),K=u(()=>parseFloat(M.value)+parseFloat($.value)),X=u(()=>{var t,e;return o.value&&m.value&&_.value>=(((t=s.value)==null?void 0:t.min_rental_days)||1)&&_.value<=(((e=s.value)==null?void 0:e.max_rental_days)||30)}),Z=t=>t?d.formatDate(t,"MMM D, YYYY"):"",B=t=>t?`${t} 00:00:00`:null,C=async()=>{if(!(!o.value||!m.value)){x.value=!0;try{await new Promise(t=>setTimeout(t,500))}finally{x.value=!1}}},ee=async()=>{try{v.value=!0;const t={product_id:s.value.id,start_date:B(o.value),end_date:B(m.value)},e=await W.createOffer(t);(e.status==="success"||e.status===200)&&(w.value=!0,setTimeout(()=>{A.push({name:"offers"})},1e3))}catch(t){console.error("Error submitting offer:",t)}finally{v.value=!1}},F=async()=>{v.value=!0,h.value=null;try{const t=await G.fetchProductById(z.params.id);s.value=t}catch(t){h.value="Failed to load product details",console.error("Error fetching product:",t)}finally{v.value=!1}},y=t=>t?(typeof t=="string"?parseFloat(t):t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0",ae=t=>{};return re(()=>{F()}),(t,e)=>{var D,g;return c(),Y(j,null,[l(ve,{loading:v.value,error:h.value},{header:n(()=>[l(ye,{loading:v.value},{title:n(()=>e[6]||(e[6]=[ue(" Rent now ")])),_:1},8,["loading"])]),"error-action":n(()=>[l(k,{color:"primary",label:"Retry",onClick:F})]),details:n(()=>{var p,O,R,T,U;return[a("div",ge,[a("div",xe,[s.value?(c(),Y(j,{key:0},[(O=(p=s.value)==null?void 0:p.media)!=null&&O.length?(c(),b(De,{key:0,images:s.value.media,onClickImage:ae},null,8,["images"])):(c(),Y("img",Ye))],64)):(c(),b(de,{key:1,class:"w-full h-full aspect-[4/3]"})),a("div",be,[a("h2",we,i((R=s.value)==null?void 0:R.title),1),a("p",he,"$"+i(y((T=s.value)==null?void 0:T.price))+"/day",1)])]),a("div",Me,[s.value?(c(),Y("div",ke,[l(me,{size:"50px"},{default:n(()=>[a("img",{src:s.value.user.profile_picture||"https://placehold.co/100x100"},null,8,Ve)]),_:1}),a("div",null,[a("div",Pe,[a("h3",Qe,i(s.value.user.name),1),s.value.user.verified?(c(),b(V,{key:0,name:"verified",color:"primary",size:"20px"})):P("",!0)]),a("p",Se,"Member since "+i(Z(s.value.user.created_at)),1)])])):P("",!0)]),a("div",$e,[e[9]||(e[9]=a("h3",{class:"text-lg font-semibold"},"Rental Period",-1)),a("div",Be,[a("div",null,[e[7]||(e[7]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Start Date",-1)),l(E,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value=r),mask:"####-##-##",placeholder:"YYYY-MM-DD",class:"w-full",rules:[r=>!r||/^\d{4}-\d{2}-\d{2}$/.test(r)||"Please use YYYY-MM-DD format"]},{append:n(()=>[l(V,{name:"event",class:"cursor-pointer"},{default:n(()=>[l(I,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[l(N,{modelValue:o.value,"onUpdate:modelValue":[e[0]||(e[0]=r=>o.value=r),C],mask:"YYYY-MM-DD",min:Q.value,max:q.value},null,8,["modelValue","min","max"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),a("div",null,[e[8]||(e[8]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"End Date",-1)),l(E,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=r=>m.value=r),mask:"####-##-##",placeholder:"YYYY-MM-DD",class:"w-full",disable:!o.value,rules:[r=>!r||/^\d{4}-\d{2}-\d{2}$/.test(r)||"Please use YYYY-MM-DD format"]},{append:n(()=>[l(V,{name:"event",class:"cursor-pointer"},{default:n(()=>[l(I,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[l(N,{modelValue:m.value,"onUpdate:modelValue":[e[2]||(e[2]=r=>m.value=r),C],mask:"YYYY-MM-DD",min:H.value,max:J.value,disable:!o.value},null,8,["modelValue","min","max","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable","rules"])])])]),a("div",{class:ie(["bg-white rounded-lg p-4 shadow-sm space-y-4",{"opacity-50":x.value}])},[a("div",Ce,[e[15]||(e[15]=a("h3",{class:"text-lg font-semibold"},"Price Breakdown",-1)),x.value?(c(),b(ce,{key:0,class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",color:"primary",size:"2em"})):P("",!0),a("div",Fe,[a("div",Oe,[e[10]||(e[10]=a("span",{class:"text-gray-600"},"Daily Rate",-1)),a("span",null,"$"+i(y((U=s.value)==null?void 0:U.price))+"/day",1)]),a("div",Re,[e[11]||(e[11]=a("span",{class:"text-gray-600"},"Duration",-1)),a("span",null,i(y(_.value))+" days",1)]),a("div",Te,[e[12]||(e[12]=a("span",{class:"text-gray-600"},"Subtotal",-1)),a("span",null,"$"+i(y(M.value)),1)]),a("div",Ue,[a("span",je,"Tax ("+i(S.value)+"%)",1),a("span",null,"$"+i(y($.value)),1)]),e[14]||(e[14]=a("div",{class:"h-px bg-gray-200 my-2"},null,-1)),a("div",Ie,[e[13]||(e[13]=a("span",null,"Total",-1)),a("span",null,"$"+i(y(K.value)),1)])])])],2),a("div",Ne,[l(k,{outline:"",color:"primary",class:"flex-1",label:"Go Back","no-caps":"",onClick:e[4]||(e[4]=r=>t.$router.back())}),l(k,{color:"primary",class:"flex-1","no-caps":"",label:"Make Offer",disable:!X.value,onClick:ee},null,8,["disable"])])])]}),_:1},8,["loading","error"]),l(_e,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=p=>w.value=p),message:`You've sent an offer to ${(g=(D=s.value)==null?void 0:D.user)==null?void 0:g.username}`},null,8,["modelValue","message"])],64)}}};var pa=te(Ee,[["__scopeId","data-v-557110ec"]]);export{pa as default};
