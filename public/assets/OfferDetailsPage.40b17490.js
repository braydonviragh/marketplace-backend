import{_ as ge,f as xe,u as he,r as g,A as f,l as we,o as n,c as i,e as l,w as p,v as be,F as v,ab as ke,a as e,N as De,t as u,Q as y,M as Ce,i as oe,m as B,g as R,d as ne,p as Oe,q as Qe,s as Ye,C as Se}from"./index.1c4d6210.js";import{Q as c}from"./QSkeleton.328d8280.js";import{Q as je}from"./QAvatar.49b81a3c.js";import{Q as Me}from"./QCardActions.d9fc1017.js";import{d as Y}from"./date.81f279e8.js";import{u as Be}from"./use-quasar.119ee7f8.js";import{u as Re}from"./offers.0aebfdef.js";import{D as Ve,_ as $e}from"./DetailPageHeader.bf150764.js";import{_ as ze}from"./SuccessDialog.a3ea3691.js";import{I as Ae}from"./ImageCarousel.ff87f89f.js";import"./format.8ac60962.js";import"./QImg.20990920.js";import"./QCarousel.5ccbe75b.js";import"./use-panel.fbc385e3.js";import"./touch.9135741d.js";import"./selection.f0756317.js";import"./use-render-cache.3aae9b27.js";const Ie={class:"space-y-6"},Ne={key:0,class:"flex items-center justify-between"},Pe={class:"flex items-center gap-2"},Ue={class:"text-lg font-semibold m-0 capitalize"},Fe={class:"text-sm text-gray-600 m-0"},Te={key:0},Ee={class:"flex gap-2"},Le={key:1,class:"flex items-center justify-between"},qe={class:"flex items-center gap-2"},Ge={class:"bg-white rounded-lg shadow-sm overflow-hidden"},We={key:1,src:"https://placehold.co/600x400",class:"w-full h-full object-cover"},He={class:"p-4"},Je={class:"text-lg font-semibold"},Ke={class:"text-primary font-medium"},Xe={class:"bg-white rounded-lg p-4 shadow-sm space-y-4"},Ze={class:"space-y-3"},et={class:"flex justify-between items-center"},tt={class:"font-medium"},st={class:"flex justify-between items-center"},at={class:"font-medium"},lt={class:"flex justify-between items-center"},ot={class:"font-medium"},nt={class:"bg-white rounded-lg p-4 shadow-sm space-y-4"},rt={class:"space-y-2"},ut={class:"flex justify-between"},it={class:"flex justify-between"},ct={class:"flex justify-between"},dt={class:"flex justify-between"},ft={class:"text-gray-600"},pt={class:"flex justify-between font-semibold"},vt={class:"bg-white rounded-lg p-4 shadow-sm"},mt={class:"text-lg font-semibold mb-4"},yt={class:"flex items-center gap-3"},_t=["src"],gt={class:"flex items-center gap-2"},xt={class:"text-lg font-medium m-0 text-primary"},ht={class:"text-gray-500 text-sm m-0"},wt={class:"flex-1"},bt={key:0,class:"flex gap-4"},kt={key:1,class:"flex gap-4"},Dt={__name:"OfferDetailsPage",setup(Ct){const re=ke(),S=xe();Be();const w=Re(),V=he(),a=g(null),r=g(!0),j=g(null),b=g(!1),m=g(!1),k=g(""),D=f(()=>{var s,t,o,d;return((o=(t=(s=a.value)==null?void 0:s.product)==null?void 0:t.user)==null?void 0:o.id)===((d=V.currentUser)==null?void 0:d.id)}),C=f(()=>a.value?D.value?a.value.user:a.value.product.user:null),ue=f(()=>{var s;switch((s=a.value)==null?void 0:s.status){case"pending":return"pending";case"accepted":return"check_circle";case"declined":return"cancel";case"cancelled":return"block";default:return"help"}}),ie=f(()=>{var s;switch((s=a.value)==null?void 0:s.status){case"pending":return"warning";case"accepted":return"positive";case"declined":case"cancelled":return"negative";default:return"grey"}}),ce=f(()=>{var s;switch((s=a.value)==null?void 0:s.status){case"pending":return"Waiting for response";case"accepted":return"Offer has been accepted";case"declined":return"Offer has been declined";case"cancelled":return"Offer has been cancelled";default:return""}}),O=f(()=>{var s,t;return!((s=a.value)!=null&&s.start_date)||!((t=a.value)!=null&&t.end_date)?0:Y.getDateDiff(Y.extractDate(a.value.end_date,"YYYY-MM-DD"),Y.extractDate(a.value.start_date,"YYYY-MM-DD"),"days")}),M=f(()=>{var s,t;return!((t=(s=a.value)==null?void 0:s.product)!=null&&t.price)||!O.value?0:a.value.product.price*O.value}),$=f(()=>{var o,d,h;const s=(h=(d=(o=V.currentUser)==null?void 0:o.profile)==null?void 0:d.province)==null?void 0:h.code;return{ON:13,BC:12,AB:5}[s]||13}),z=f(()=>M.value*$.value/100),de=f(()=>M.value+z.value),Q=s=>s?Y.formatDate(s,"MMM D, YYYY"):"",x=s=>s?(typeof s=="string"?parseFloat(s):s).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",fe=()=>{},pe=async()=>{var s,t;try{r.value=!0,(await w.updateOfferStatus(a.value.id,"accepted")).status==="success"&&(k.value=`You've accepted the offer from ${(t=(s=a.value)==null?void 0:s.user)==null?void 0:t.name}`,m.value=!0,setTimeout(()=>{m.value=!1,S.push({name:"offers"})},1500))}catch(o){console.error("Error accepting offer:",o)}finally{r.value=!1}},ve=async()=>{var s,t;try{r.value=!0,(await w.updateOfferStatus(a.value.id,"declined")).status==="success"&&(k.value=`You've declined the offer from ${(t=(s=a.value)==null?void 0:s.user)==null?void 0:t.name}`,m.value=!0,setTimeout(()=>{m.value=!1,S.push({name:"offers"})},1500))}catch(o){console.error(o)}finally{r.value=!1}},me=()=>{b.value=!0},ye=async()=>{var s,t,o;try{r.value=!0,(await w.updateOfferStatus(a.value.id,"cancelled")).status==="success"&&(b.value=!1,k.value=`You've cancelled your offer to ${(o=(t=(s=a.value)==null?void 0:s.product)==null?void 0:t.user)==null?void 0:o.name}`,m.value=!0,setTimeout(()=>{m.value=!1,S.push({name:"offers"})},1500))}catch(d){console.error("Error cancelling offer:",d)}finally{r.value=!1}},A=async()=>{r.value=!0,j.value=null;try{const s=await w.fetchOfferById(re.params.id);a.value=s}catch(s){j.value="Failed to load offer details",console.error("Error fetching offer:",s)}finally{r.value=!1}},_e=s=>{};return we(()=>{A()}),(s,t)=>(n(),i(v,null,[l(Ve,{loading:r.value,error:j.value},{header:p(()=>[l($e,{loading:r.value},{title:p(()=>[t[2]||(t[2]=e("span",null,"Offer Details",-1)),De(" "+u(D.value),1)]),action:p(()=>[l(y,{flat:"",round:"",dense:"",color:"primary",icon:"more_vert",onClick:fe})]),_:1},8,["loading"])]),"error-action":p(()=>[l(y,{color:"primary",label:"Retry",onClick:A})]),details:p(()=>{var o,d,h,I,N,P,U,F,T,E,L,q,G,W,H,J,K,X,Z,ee,te,se,ae,le;return[e("div",Ie,[t[13]||(t[13]=e("h1",{class:"text-2xl font-semibold m-0"},"Review Offer Details",-1)),e("div",{class:Ce(["p-4 rounded-lg",{"bg-yellow-50":((o=a.value)==null?void 0:o.status)==="pending","bg-green-50":((d=a.value)==null?void 0:d.status)==="accepted","bg-red-50":((h=a.value)==null?void 0:h.status)==="declined","bg-gray-50":((I=a.value)==null?void 0:I.status)==="cancelled"}])},[r.value?(n(),i("div",Le,[e("div",qe,[l(c,{type:"QIcon",size:"24px"}),e("div",null,[l(c,{type:"text",class:"text-lg w-32"}),l(c,{type:"text",class:"text-sm w-48"})])])])):(n(),i("div",Ne,[e("div",Pe,[l(oe,{name:ue.value,color:ie.value,size:"24px"},null,8,["name","color"]),e("div",null,[e("h3",Ue,u((N=a.value)==null?void 0:N.status),1),e("p",Fe,u(ce.value),1)])]),((P=a.value)==null?void 0:P.status)==="pending"&&D.value?(n(),i("div",Te,[e("div",Ee,[l(y,{outline:"",color:"negative",label:"Decline",size:"sm",onClick:ve}),l(y,{color:"positive",label:"Accept",size:"sm",onClick:pe})])])):B("",!0)]))],2),e("div",Ge,[!r.value&&((U=a.value)==null?void 0:U.product)?(n(),i(v,{key:0},[(E=(T=(F=a.value)==null?void 0:F.product)==null?void 0:T.media)!=null&&E.length?(n(),R(Ae,{key:0,images:a.value.product.media,onClickImage:_e},null,8,["images"])):(n(),i("img",We))],64)):(n(),R(c,{key:1,class:"w-full h-full aspect-[4/3]"})),e("div",He,[!r.value&&((L=a.value)==null?void 0:L.product)?(n(),i(v,{key:0},[e("h2",Je,u((G=(q=a.value)==null?void 0:q.product)==null?void 0:G.title),1),e("p",Ke,"$"+u(x((H=(W=a.value)==null?void 0:W.product)==null?void 0:H.price))+"/day",1)],64)):(n(),i(v,{key:1},[l(c,{type:"text",class:"text-lg w-3/4"}),l(c,{type:"text",class:"text-sm w-1/4 mt-2"})],64))])]),e("div",Xe,[t[6]||(t[6]=e("div",{class:"text-lg font-semibold"},"Rental Period",-1)),e("div",Ze,[!r.value&&a.value?(n(),i(v,{key:0},[e("div",et,[t[3]||(t[3]=e("span",{class:"text-gray-600"},"Start Date",-1)),e("span",tt,u(Q((J=a.value)==null?void 0:J.start_date)),1)]),e("div",st,[t[4]||(t[4]=e("span",{class:"text-gray-600"},"End Date",-1)),e("span",at,u(Q((K=a.value)==null?void 0:K.end_date)),1)]),e("div",lt,[t[5]||(t[5]=e("span",{class:"text-gray-600"},"Duration",-1)),e("span",ot,u(O.value)+" days",1)])],64)):(n(),i(v,{key:1},ne(3,_=>e("div",{key:_,class:"flex justify-between items-center"},[l(c,{type:"text",class:"w-24"}),l(c,{type:"text",class:"w-32"})])),64))])]),e("div",nt,[t[12]||(t[12]=e("div",{class:"text-lg font-semibold"},"Price Breakdown",-1)),e("div",rt,[!r.value&&a.value?(n(),i(v,{key:0},[e("div",ut,[t[7]||(t[7]=e("span",{class:"text-gray-600"},"Daily Rate",-1)),e("span",null,"$"+u(x((Z=(X=a.value)==null?void 0:X.product)==null?void 0:Z.price))+"/day",1)]),e("div",it,[t[8]||(t[8]=e("span",{class:"text-gray-600"},"Duration",-1)),e("span",null,u(O.value)+" days",1)]),e("div",ct,[t[9]||(t[9]=e("span",{class:"text-gray-600"},"Subtotal",-1)),e("span",null,"$"+u(x(M.value)),1)]),e("div",dt,[e("span",ft,"Tax ("+u($.value)+"%)",1),e("span",null,"$"+u(x(z.value)),1)]),t[11]||(t[11]=e("div",{class:"h-px bg-gray-200 my-2"},null,-1)),e("div",pt,[t[10]||(t[10]=e("span",null,"Total",-1)),e("span",null,"$"+u(x(de.value)),1)])],64)):(n(),i(v,{key:1},ne(5,_=>e("div",{key:_,class:"flex justify-between"},[l(c,{type:"text",class:"w-24"}),l(c,{type:"text",class:"w-32"})])),64))])]),e("div",vt,[e("div",mt,"Sent by \xB7 "+u(Q((ee=a.value)==null?void 0:ee.created_at)),1),e("div",yt,[!r.value&&a.value?(n(),i(v,{key:0},[l(je,{size:"50px"},{default:p(()=>{var _;return[e("img",{src:((_=C.value)==null?void 0:_.profile_picture)||"https://placehold.co/100x100"},null,8,_t)]}),_:1}),e("div",null,[e("div",gt,[e("h3",xt,u((te=C.value)==null?void 0:te.name),1),(se=C.value)!=null&&se.verified?(n(),R(oe,{key:0,name:"verified",color:"primary",size:"20px"})):B("",!0)]),e("p",ht,"Member since "+u(Q((ae=C.value)==null?void 0:ae.created_at)),1)])],64)):(n(),i(v,{key:1},[l(c,{type:"QAvatar",size:"50px"}),e("div",wt,[l(c,{type:"text",class:"text-lg w-48"}),l(c,{type:"text",class:"text-sm w-32"})])],64))])]),!r.value&&((le=a.value)==null?void 0:le.status)==="pending"&&!D.value?(n(),i("div",bt,[l(y,{outline:"",color:"negative",class:"flex-1",label:"Cancel Offer","no-caps":"",onClick:me})])):r.value?(n(),i("div",kt,[l(c,{type:"QBtn",class:"flex-1"}),l(c,{type:"QBtn",class:"flex-1"})])):B("",!0)])]}),_:1},8,["loading","error"]),l(be,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o)},{default:p(()=>[l(Oe,{class:"p-4"},{default:p(()=>[l(Qe,null,{default:p(()=>t[14]||(t[14]=[e("h3",{class:"text-lg font-semibold"},"Cancel Offer",-1),e("p",null,"Are you sure you want to cancel this offer?",-1)])),_:1}),l(Me,{align:"right"},{default:p(()=>[Ye(l(y,{flat:"",label:"No"},null,512),[[Se]]),l(y,{color:"negative",label:"Yes, Cancel",onClick:ye})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ze,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),message:k.value},null,8,["modelValue","message"])],64))}};var Tt=ge(Dt,[["__scopeId","data-v-33616507"]]);export{Tt as default};
