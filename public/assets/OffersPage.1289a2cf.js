import{_ as G,r as T,c as D,Y as we,L as $e,o as _,a as k,d as t,f as e,w as a,t as v,O as w,j as Q,Q as $,q as _e,s as H,aK as Ce,v as z,x as Se,F as xe,C as F,g as Oe,h as U,p as R,i as q,bc as ke,e as De,ad as Qe,u as Ve}from"./index.aed2db9c.js";import{Q as ge,b as ye,a as K}from"./QItemLabel.6796c1fb.js";import{Q as he}from"./QSelect.1cdf7b41.js";import{u as be}from"./offers.57f07724.js";import{Q as E}from"./QInput.52b28155.js";import{Q as fe}from"./QTooltip.3b42f802.js";import{Q as me,a as ve}from"./QPopupProxy.eb90e6eb.js";import{Q as Te}from"./QCardActions.499540f5.js";import{Q as ze}from"./QImg.526056a5.js";import{Q as B}from"./QChip.bb92b358.js";import{d as pe}from"./date.d974a712.js";import"./QMenu.2e7dc152.js";import"./selection.ba1a87f1.js";import"./private.use-form.e6da8665.js";import"./format.8ac60962.js";import"./use-id.1f67328e.js";import"./use-render-cache.3aae9b27.js";const Fe={class:"container mx-auto py-4"},Ue={class:"max-w-3xl mx-auto"},Re={class:"bg-white rounded-lg shadow-sm p-4"},Pe={class:"flex flex-nowrap items-center gap-2"},Me={class:"w-full sm:w-auto sm:flex-1 max-w-[200px]"},je={class:"capitalize"},Le={class:"flex items-center gap-2"},Ie={class:"capitalize"},Ye={class:"w-full sm:w-auto sm:flex-1"},Ae={class:"flex items-center flex-nowrap gap-2 self-end"},qe={class:"col-12"},Be={class:"row items-center justify-end"},Ne={class:"col-12"},Ee={class:"row items-center justify-end"},He={__name:"OfferFilters",setup(o){const r=be(),y=T(!1),C=D(()=>r.getStatusOptions);(async()=>{try{await r.fetchStatuses()}catch(n){console.error("Failed to fetch offer statuses:",n)}})();const x=T(null),V=T(""),h=T(""),i=T(null),s=T(null),f=D(()=>i.value||s.value),b=D(()=>{if(!f.value)return"Date Range";const n=i.value?j(i.value):"",l=s.value?j(s.value):"";return n&&l?`${n} - ${l}`:n?`From ${n}`:l?`Until ${l}`:"Date Range"}),d=D(()=>x.value!=null||i.value!=null||s.value!=null||h.value!=="");let u=null;const m=()=>{u&&clearTimeout(u),u=setTimeout(()=>{S()},300)},M=n=>{V.value=n.label,x.value=n,S()},L=()=>{if(i.value&&s.value&&new Date(i.value)>new Date(s.value)){const n=i.value;i.value=s.value,s.value=n}S()},S=()=>{var n;r.setFilters({offer_status_id:((n=x.value)==null?void 0:n.value)||null,search:h.value||null,start_date:i.value,end_date:s.value}),r.fetchOffers()},I=()=>{x.value=null,h.value="",i.value=null,s.value=null,r.clearFilters(),r.fetchOffers()},Y=()=>{i.value=null,s.value=null,S()},j=n=>n?new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"";we(()=>r.filters,n=>{x.value=n.offer_status_id,h.value=n.search||"",i.value=n.start_date,s.value=n.end_date},{deep:!0}),$e(()=>{u&&clearTimeout(u)});const A=()=>{V.value="",x.value=null,S()};return(n,l)=>(_(),k(xe,null,[t("div",Fe,[t("div",Ue,[t("div",Re,[t("div",Pe,[t("div",Me,[e(he,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=c=>x.value=c),options:C.value,label:"Status",outlined:"",dense:"",clearable:"","options-dense":"",onClear:A},{option:a(({opt:c})=>[e(ge,{clickable:"",onClick:N=>M(c)},{default:a(()=>[e(ye,null,{default:a(()=>[e(K,{class:"flex items-center gap-2"},{default:a(()=>[t("span",je,v(c.label),1)]),_:2},1024),e(K,{caption:""},{default:a(()=>[w(v(c.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),selected:a(()=>[t("div",Le,[t("span",Ie,v(V.value||""),1)])]),_:1},8,["modelValue","options"])]),t("div",Ye,[e(E,{modelValue:h.value,"onUpdate:modelValue":[l[1]||(l[1]=c=>h.value=c),m],outlined:"",dense:"",placeholder:"Search offers..."},{append:a(()=>[e(Q,{name:"search"})]),_:1},8,["modelValue"])]),t("div",Ae,[e($,{round:"",flat:"",dense:"",color:f.value?"primary":"grey",icon:"event",onClick:l[2]||(l[2]=c=>y.value=!0)},{default:a(()=>[e(fe,null,{default:a(()=>[w(v(f.value?b.value:"Filter by date"),1)]),_:1})]),_:1},8,["color"]),e($,{flat:"",dense:"",color:"primary",icon:"refresh",onClick:I,disable:!d.value},{default:a(()=>[e(fe,null,{default:a(()=>l[8]||(l[8]=[w("Reset filters")])),_:1})]),_:1},8,["disable"])])])])])]),e(Se,{modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=c=>y.value=c)},{default:a(()=>[e(_e,{class:"q-pa-md",style:{"min-width":"350px"}},{default:a(()=>[e(H,{class:"row items-center q-pb-none"},{default:a(()=>[l[9]||(l[9]=t("div",{class:"text-h6"},"Select Date Range",-1)),e(Ce),z(e($,{icon:"close",flat:"",round:"",dense:""},null,512),[[F]])]),_:1}),e(H,{class:"row q-col-gutter-md"},{default:a(()=>[t("div",qe,[e(E,{modelValue:i.value,"onUpdate:modelValue":l[4]||(l[4]=c=>i.value=c),outlined:"",dense:"",label:"From",type:"date"},{prepend:a(()=>[e(Q,{name:"event",class:"cursor-pointer"},{default:a(()=>[e(me,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(ve,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=c=>i.value=c)},{default:a(()=>[t("div",Be,[z(e($,{label:"Close",color:"primary",flat:""},null,512),[[F]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",Ne,[e(E,{modelValue:s.value,"onUpdate:modelValue":l[6]||(l[6]=c=>s.value=c),outlined:"",dense:"",label:"To",type:"date"},{prepend:a(()=>[e(Q,{name:"event",class:"cursor-pointer"},{default:a(()=>[e(me,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(ve,{modelValue:s.value,"onUpdate:modelValue":l[5]||(l[5]=c=>s.value=c)},{default:a(()=>[t("div",Ee,[z(e($,{label:"Close",color:"primary",flat:""},null,512),[[F]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1}),e(Te,{align:"right"},{default:a(()=>[z(e($,{flat:"",label:"Clear",color:"grey",onClick:Y},null,512),[[F]]),z(e($,{flat:"",label:"Apply",color:"primary",onClick:L},null,512),[[F]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var Ke=G(He,[["__scopeId","data-v-7cd0ac89"]]);const Ge={class:"flex flex-col sm:flex-row justify-between items-start min-h-[150px]"},Je={class:"mb-4 sm:mb-0 sm:mr-4 w-full sm:w-auto flex sm:block items-center justify-between"},We={class:"sm:mt-2 text-center"},Xe={class:"text-base sm:text-lg font-semibold text-primary"},Ze={class:"flex-grow w-full sm:w-auto"},et={class:"flex items-center gap-2 flex-wrap"},tt={class:"text-base sm:text-lg font-medium m-0 line-clamp-2"},at={class:"text-gray-600 text-xs sm:text-sm space-y-1 mt-2"},st={class:"flex items-center gap-1"},lt={class:"flex items-center gap-1"},ot={class:"flex items-center gap-1"},nt={class:"mt-2 flex items-start flex-wrap gap-1"},rt={class:"text-right w-full sm:w-auto sm:ml-4 mt-4 sm:mt-0"},it={key:0,class:"flex gap-2 justify-end"},ut="https://placehold.co/600x400/eeeeee/999999?text=No+Image",ct={__name:"OfferCard",props:{offer:{type:Object,required:!0},isReceived:{type:Boolean,default:!1}},emits:["update-status"],setup(o,{emit:r}){const y=Oe(),C=o,P=D(()=>C.isReceived&&C.offer.status_id===1),x=s=>({1:"accent",2:"positive",3:"danger",4:"red",5:"red"})[s]||"grey",V=(s,f)=>{const b=pe.formatDate(s,"MMM D, YYYY"),d=pe.formatDate(f,"MMM D, YYYY");return`${b} - ${d}`},h=(s,f,b)=>{const d=new Date(f),u=new Date(b),m=Math.ceil((u-d)/(1e3*60*60*24));return(parseFloat(s)*m).toFixed(2)},i=s=>{y.push({name:"offer-details",params:{id:s}})};return(s,f)=>(_(),U(_e,{class:"offer-card cursor-pointer",onClick:f[2]||(f[2]=b=>{var d;return i((d=o.offer)==null?void 0:d.id)})},{default:a(()=>[e(H,null,{default:a(()=>{var b,d,u,m,M,L,S,I,Y,j,A,n,l,c,N,J,W,X,Z,ee,te,ae,se,le,oe,ne,re,ie,ue,ce,de;return[t("div",Ge,[t("div",Je,[e(ze,{src:((m=(u=(d=(b=o.offer)==null?void 0:b.product)==null?void 0:d.media)==null?void 0:u[0])==null?void 0:m.url)||ut,ratio:1,class:"rounded-full",style:{width:"80px",height:"80px"}},null,8,["src"]),t("div",We,[f[3]||(f[3]=t("div",{class:"text-xs sm:text-sm text-gray-600"},"Total Price",-1)),t("div",Xe,"$"+v(h((L=(M=o.offer)==null?void 0:M.product)==null?void 0:L.price,(S=o.offer)==null?void 0:S.start_date,(I=o.offer)==null?void 0:I.end_date)),1)])]),t("div",Ze,[t("div",et,[t("h3",tt,v((j=(Y=o.offer)==null?void 0:Y.product)==null?void 0:j.title),1)]),t("div",at,[t("p",st,[e(Q,{name:"person",size:"14px"}),w(" "+v(o.isReceived?"From: "+((n=(A=o.offer)==null?void 0:A.user)==null?void 0:n.name):"To: "+((N=(c=(l=o.offer)==null?void 0:l.product)==null?void 0:c.user)==null?void 0:N.username)),1)]),t("p",lt,[e(Q,{name:"location_on",size:"14px"}),w(" "+v((X=(W=(J=o.offer)==null?void 0:J.product)==null?void 0:W.location)==null?void 0:X.city)+", "+v((ae=(te=(ee=(Z=o.offer)==null?void 0:Z.product)==null?void 0:ee.location)==null?void 0:te.province)==null?void 0:ae.abbreviation),1)]),t("p",ot,[e(Q,{name:"event",size:"14px"}),w(" "+v(V((se=o.offer)==null?void 0:se.start_date,(le=o.offer)==null?void 0:le.end_date)),1)]),t("div",nt,[(ne=(oe=o.offer)==null?void 0:oe.product)!=null&&ne.brand?(_(),U(B,{key:0,dense:"",outline:"",color:"primary",class:"text-xs",size:"sm"},{default:a(()=>{var g,p,O;return[w(v((O=(p=(g=o.offer)==null?void 0:g.product)==null?void 0:p.brand)==null?void 0:O.name),1)]}),_:1})):R("",!0),(ie=(re=o.offer)==null?void 0:re.product)!=null&&ie.size?(_(),U(B,{key:1,dense:"",outline:"",color:"primary",class:"text-xs",size:"sm"},{default:a(()=>{var g,p,O;return[w(v((O=(p=(g=o.offer)==null?void 0:g.product)==null?void 0:p.size)==null?void 0:O.display_name),1)]}),_:1})):R("",!0),(ce=(ue=o.offer)==null?void 0:ue.product)!=null&&ce.color?(_(),U(B,{key:2,dense:"",outline:"",color:"primary",class:"text-xs",size:"sm"},{default:a(()=>{var g,p,O;return[w(v((O=(p=(g=o.offer)==null?void 0:g.product)==null?void 0:p.color)==null?void 0:O.name),1)]}),_:1})):R("",!0)])])]),t("div",rt,[e(B,{color:x((de=o.offer)==null?void 0:de.status_id),"text-color":"white",class:"mb-2 capitalize text-xs sm:text-sm",size:"sm"},{default:a(()=>{var g;return[w(v((g=o.offer)==null?void 0:g.status),1)]}),_:1},8,["color"]),P.value?(_(),k("div",it,[e($,{flat:"",color:"positive",label:"Accept",size:"sm",class:"text-xs sm:text-sm",onClick:f[0]||(f[0]=g=>{var p;return s.$emit("update-status",{id:(p=o.offer)==null?void 0:p.id,status:"accepted"})})}),e($,{flat:"",color:"negative",label:"Reject",size:"sm",class:"text-xs sm:text-sm",onClick:f[1]||(f[1]=g=>{var p;return s.$emit("update-status",{id:(p=o.offer)==null?void 0:p.id,status:"rejected"})})})])):R("",!0)])])]}),_:1})]),_:1}))}};var dt=G(ct,[["__scopeId","data-v-36a079a6"]]);const ft={class:"q-pa-md"},mt={class:"container mx-auto"},vt={class:"flex justify-between items-center"},pt={class:"truncate"},_t={class:"flex items-center gap-2 text-sm"},xt={class:"truncate"},gt={key:0,class:"grid gap-4"},yt={key:0,class:"text-center py-8"},ht={key:1,class:"flex justify-center py-8"},bt={key:2,class:"text-center mt-6"},wt={__name:"OffersPage",setup(o){const r=be(),y=r.getActiveTab,C=T(!1),P=D(()=>{var d;return((d=r.tabOptions)==null?void 0:d.find(u=>u.value===r.getActiveTab))||r.tabOptions[0]}),x=D(()=>r.getOffers),V=D(()=>r.pagination.currentPage<r.pagination.totalPages),h=async d=>{r.setActiveTab(d),r.clearFilters(),await i()},i=async()=>{if(!Ve().currentUser){console.log("Skipping offers load: User not authenticated");return}await r.fetchOffers()},s=async()=>{if(!C.value)try{C.value=!0,r.pagination.currentPage++,await i()}finally{C.value=!1}},f=async({id:d,status:u})=>{try{await r.updateOfferStatus(d,u),await i()}catch(m){console.error("Failed to update offer status:",m)}};return(async()=>{await i()})(),(d,u)=>(_(),k("div",ft,[t("div",mt,[t("div",vt,[u[1]||(u[1]=t("h1",{class:"text-2xl font-semibold"},"My Offers",-1)),e(he,{modelValue:q(y),"onUpdate:modelValue":u[0]||(u[0]=m=>ke(y)?y.value=m:null),options:q(r).tabOptions,outlined:"",dense:"","option-value":"value","option-label":"label",style:{width:"200px"},class:"offers-select"},{option:a(({opt:m})=>[z((_(),U(ge,{clickable:"",onClick:M=>h(m.value)},{default:a(()=>[e(ye,null,{default:a(()=>[e(K,{class:"flex items-center gap-2 text-sm"},{default:a(()=>[e(Q,{name:m.icon,size:"20px",class:"flex-none"},null,8,["name"]),t("span",pt,v(m.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[F]])]),selected:a(()=>[t("div",_t,[e(Q,{name:P.value.icon,size:"20px",class:"flex-none"},null,8,["name"]),t("span",xt,v(P.value.label),1)])]),_:1},8,["modelValue","options"])]),e(Ke,{class:"mb-6"}),q(r).isLoading?(_(),k("div",ht,[e(Qe,{color:"primary",size:"3em"})])):(_(),k("div",gt,[(_(!0),k(xe,null,De(x.value,m=>(_(),U(dt,{key:m.id,offer:m,"is-received":q(y)==="received",onUpdateStatus:f},null,8,["offer","is-received"]))),128)),x.value.length===0?(_(),k("div",yt,u[2]||(u[2]=[t("p",{class:"text-gray-500"},"No offers found",-1)]))):R("",!0)])),V.value?(_(),k("div",bt,[e($,{flat:"",color:"primary",label:"Load More",onClick:s,loading:C.value},null,8,["loading"])])):R("",!0)])]))}};var It=G(wt,[["__scopeId","data-v-3046aecb"]]);export{It as default};
